(function(e){function t(t){for(var r,s,o=t[0],c=t[1],u=t[2],d=0,g=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&g.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(g.length)g.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,o=1;o<n.length;o++){var c=n[o];0!==a[c]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={app:0},i=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/static/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("4b77")},"17ff":function(e,t,n){},1934:function(e,t,n){},2231:function(e,t,n){"use strict";n("360a")},"360a":function(e,t,n){},"3a62":function(e,t,n){},"3bc9":function(e,t,n){},"3e1a":function(e,t,n){"use strict";n("853f")},"4b77":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("6b5e"),n("b681"),n("4855"),n("a43b");var r=n("430a"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-view")},i=[],s={},o=s,c=(n("034f"),n("cba8")),u=Object(c["a"])(o,a,i,!1,null,null,null),l=u.exports,d=n("a5e4"),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",{staticClass:"base-container"},[n("el-header",{staticClass:"base-header",attrs:{height:"50x"}},[n("el-row",[n("el-col",{staticClass:"nav-item",attrs:{span:18}},[n("a",[e._v("IPA对话系统")])])],1)],1),n("el-main",{staticClass:"base-main"},[n("router-view",{on:{exitLogin:e.exitLogin}})],1)],1)},h=[],p=(n("6a4a"),n("a82d"),{name:"Base",data:function(){return{isLogin:!1,usn:""}},methods:{autoLogin:function(){var e=localStorage["usn"];e||this.$store.state.user.isLogin?(this.isLogin=!0,this.usn=e||this.$store.state.user.user):(this.isLogin=!1,this.usn="")},exitLogin:function(){this.$store.commit("user/exitUser"),this.isLogin=!1,this.usn="",this.$router.replace("/dialog")},changeTab:function(e){if("login"==e)this.$router.replace("/login");else if("list"==e){if(!this.$store.state.user.isLogin)return void this.$router.replace("/login");this.$router.replace("/list")}else"dialog"==e&&this.$router.replace("/dialog")}},mounted:function(){},beforeUpdate:function(){this.autoLogin()}}),m=p,f=(n("2231"),Object(c["a"])(m,g,h,!1,null,"c2233864",null)),_=f.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("div",{staticClass:"dialogPage-dialog"},[n("Dialog")],1)])},v=[],x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",[n("el-col",{attrs:{span:8}},[n("div",{staticClass:"dialog-main"},[n("div",{staticClass:"dialog-header"},[n("el-select",{attrs:{disabled:!e.enable_change_dialog,"value-key":"name",placeholder:"对话id"},on:{change:e.changeDialog},model:{value:e.current_dialog,callback:function(t){e.current_dialog=t},expression:"current_dialog"}},e._l(e.all_dialog,(function(t,r){return n("el-option",{key:r,attrs:{label:t.name,value:t}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),n("span",{class:t.color,staticStyle:{float:"right","font-size":"13px"}},[e._v(e._s(t.check_status))])])})),1),e._v(" 当前轮数:"+e._s(e.current_turn)+" ")],1),n("el-button-group",[n("el-button",{attrs:{type:"primary"},on:{click:e.lastTurn}},[e._v(" 上一轮 ")]),n("el-button",{attrs:{type:"primary"},on:{click:e.getNextTurn}},[e._v(" 下一轮 ")]),n("el-button",{attrs:{type:"success",disabled:e.enable_save},on:{click:e.saveImages}},[e._v("保存 "),n("i",{staticClass:"el-icon-video-pause"})])],1),n("div",{staticClass:"dialog-dialog",attrs:{id:"dialog-window"}},e._l(e.dialog,(function(t,r){return n("Talk",{key:r,attrs:{data:t,index:r,selected:r>=2*e.current_turn&&r<=2*e.current_turn+1},on:{editTurn:e.editTurn,inputFocus:e.setInputFocus}})})),1)],1)]),n("el-col",{attrs:{span:10}},[n("ImageSimulator",{ref:"simulator",attrs:{image:e.image},on:{swipe:e.swipe,doubleTap:e.doubleTap,singleTap:e.singleTap,getScreen:e.getScreenshot,goBack:e.goBack,home:e.home,input:e.inputText,inputFocus:e.setInputFocus,clear:e.clearInput,read:e.readBox,inputChar:e.inputChar}})],1),n("el-col",{attrs:{span:6}},[n("ImageList",{ref:"imageList"})],1)],1)},w=[],k=n("dc45"),y=(n("9133"),n("937b"),n("ecfb"),n("e186"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.data.isUser?n("UserTalk",{attrs:{data:e.data,index:e.index,selected:e.selected},on:{inputFocus:e.handleFocus,editTurn:e.handleEdit}}):n("SysTalk",{attrs:{data:e.data,index:e.index,selected:e.selected},on:{inputFocus:e.handleFocus,editTurn:e.handleEdit}})}),T=[],$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"talk-box"},[n("span",{staticClass:"el-icon-user-solid avatar"}),e.enable_edit?n("el-input",{attrs:{autofocus:""},on:{blur:e.handleBlur},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}):n("div",{staticClass:"text-box",class:{border:e.selected},on:{dblclick:e.handleEdit}},[n("el-popover",{attrs:{placement:"bottom",title:"参考翻译:",width:"300",trigger:"hover",content:e.data.program}},[n("div",{staticClass:"text-box",attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(e.data.text))])])],1)],1)},R=[],L={props:["data","index","selected"],data:function(){return{url:"",enable_edit:!1,input:""}},methods:{handleEdit:function(){this.input=this.data.text,this.enable_edit=!0,this.$emit("inputFocus",!0)},handleBlur:function(){this.enable_edit=!1,this.$emit("inputFocus",!1),this.$emit("editTurn",this.index,this.input)}},computed:{table:function(){return this.data.table},colName:function(){if(this.data.colName)return this.data.colName;var e={};for(var t in this.data.table[0])e[t]=t;return e}}},N=L,O=(n("e91e"),Object(c["a"])(N,$,R,!1,null,"d7e13760",null)),S=O.exports,j=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"talk-box"},[e.enable_edit?n("el-input",{attrs:{autofocus:""},on:{blur:e.handleBlur},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}):n("span",{staticClass:"text-box",class:{border:e.selected},on:{dblclick:e.handleEdit}},[n("el-popover",{attrs:{placement:"bottom",title:"参考翻译:",width:"300",trigger:"hover",content:e.data.program}},[n("div",{staticClass:"text-box",attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(e.data.text))])])],1),n("span",{staticClass:"el-icon-user-solid avatar"})],1)},I=[],C={props:["data","index","selected"],data:function(){return{url:"",enable_edit:!1,input:""}},methods:{handleEdit:function(){this.input=this.data.text,this.enable_edit=!0,this.$emit("inputFocus",!0)},handleBlur:function(){this.enable_edit=!1,this.$emit("inputFocus",!1),this.$emit("editTurn",this.index,this.input)}}},B=C,M=(n("d5b6"),Object(c["a"])(B,j,I,!1,null,"71b96a5f",null)),D=M.exports,E={props:["data","index","selected"],components:{SysTalk:S,UserTalk:D},data:function(){return{}},methods:{handleFocus:function(e){console.log("focus",e),this.$emit("inputFocus",e)},handleEdit:function(e,t){console.log("edit turn",e,t),this.$emit("editTurn",e,t)}}},P=E,F=Object(c["a"])(P,y,T,!1,null,"5365b570",null),U=F.exports,z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",[n("el-col",{attrs:{span:12}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],style:{width:e.width,height:e.height}},[e.enable_select?n("ImageSelector",{attrs:{image:e.image,width:e.width,height:e.height},on:{box:e.getImageBox}}):n("img",{ref:"image",attrs:{src:e.image,id:"screen",width:e.width,height:e.height,draggable:"false"},on:{touchstart:e.touchstart,MSPointerDown:e.touchstart,pointerdown:e.touchstart,touchmove:e.touchmove,MSPointerMove:e.touchmove,pointermove:e.touchmove,touchend:e.touchend,MSPointerUp:e.touchend,pointerup:e.touchend,touchcancel:e.cancelAll,MSPointerCancel:e.cancelAll,pointercancel:e.cancelAll}})],1)]),n("el-col",{attrs:{span:10}},[n("el-card",{style:{marginBottom:"10px"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("状态提示")])]),n("div",[e._v(e._s(e.notice))])]),n("el-card",[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("操作")])]),n("div",{staticClass:"dialog-input"},[n("el-input",{attrs:{placeholder:"请输入内容"},on:{focus:function(t){return e.changeFocus(!0)},blur:function(t){return e.changeFocus(!1)}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.inputText.apply(null,arguments)}},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-s-promotion",type:"success"},on:{click:e.inputText},slot:"append"})],1)],1),n("el-button-group",{style:{marginTop:"10px"}},[n("el-button",{attrs:{icon:"el-icon-back"},on:{click:function(t){return e.swipeButton("left")}}},[e._v("左滑")]),n("el-button",{attrs:{icon:"el-icon-right"},on:{click:function(t){return e.swipeButton("right")}}},[e._v("右滑")]),n("el-button",{attrs:{icon:"el-icon-top"},on:{click:function(t){return e.swipeButton("up")}}},[e._v("上滑")]),n("el-button",{attrs:{icon:"el-icon-bottom"},on:{click:function(t){return e.swipeButton("down")}}},[e._v("下滑")]),n("el-button",{attrs:{icon:"el-icon-back"},on:{click:e.goBack}},[e._v("返回")]),n("el-button",{attrs:{icon:"el-icon-check"},on:{click:function(t){return e.inputChar("enter")}}},[e._v("回车")]),n("el-button",{attrs:{icon:"el-icon-check"},on:{click:e.home}},[e._v("返回桌面")]),n("el-button",{attrs:{type:"plain"},on:{click:e.clear}},[e._v("清除输入")])],1),n("el-button-group",{style:{marginTop:"10px",marginBottom:"10px"}},[n("el-button",{attrs:{icon:"el-icon-view"},on:{click:e.readBox}},[e._v("读取")]),n("el-button",{attrs:{icon:"el-icon-view"},on:{click:e.confirmBox}},[e._v("读取确认")])],1),n("el-button",{attrs:{icon:"el-icon-camera",type:"primary"},on:{click:e.getScreen}},[e._v("截图")])],1)],1)],1)],1)},Y=[],X=(n("c0bf"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"selector-box",attrs:{width:e.width,height:e.height},on:{mousedown:e.handleMouseDown}},[n("div",{staticClass:"mask",style:e.bbox}),n("img",{staticClass:"image",attrs:{src:e.image,width:e.width,height:e.height}})])}),A=[],J={name:"ImageSelector",props:["image","width","height"],data:function(){return{start_x:0,start_y:0,end_x:0,end_y:0,compute_size:!1}},methods:{handleMouseDown:function(e){e.preventDefault(),this.compute_size=!1,this.start_x=e.offsetX,this.start_y=e.offsetY,document.body.addEventListener("mousemove",this.handleMouseMove),document.body.addEventListener("mouseup",this.handleMouseUp)},handleMouseMove:function(e){this.compute_size=!0,this.end_x=e.offsetX,this.end_y=e.offsetY},handleMouseUp:function(){document.body.removeEventListener("mousemove",this.handleMouseMove),document.body.removeEventListener("mouseup",this.handleMouseUp),this.$emit("box",{width:this.mask_width,height:this.mask_height,top:this.mask_top,left:this.mask_left})},resSetXY:function(){this.start_x=0,this.start_y=0,this.end_x=0,this.end_y=0}},computed:{mask_top:function(){return this.start_y<this.end_y?this.start_y:this.end_y},mask_left:function(){return this.start_x<this.end_x?this.start_x:this.end_x},mask_width:function(){return Math.abs(this.start_x-this.end_x)},mask_height:function(){return Math.abs(this.start_y-this.end_y)},bbox:function(){if(this.compute_size){var e="width:"+this.mask_width+"px;left:"+this.mask_left+"px;height:"+this.mask_height+"px;top:"+this.mask_top+"px;";return e}return"width:0px;left:0px;height:0px;top:0px;"}}},V=J,q=(n("adeb"),Object(c["a"])(V,X,A,!1,null,"41a1cdba",null)),H=q.exports,W={name:"ImageSimulator",data:function(){return{touch:{},touchTimeout:null,tapTimeout:null,swipeTimeout:null,longTapTimeout:null,longTapDelay:750,gesture:null,now:null,delta:0,deltaX:0,deltaY:0,firstTouch:null,isPointerType:!1,screen_width:1440,screen_height:2560,scale:.25,image:null,loading:!1,input:"",enable_select:!1,image_box:null,notice:""}},computed:{width:function(){return this.screen_width*this.scale+"px"},height:function(){return this.screen_height*this.scale+"px"}},mounted:function(){this.$emit("getScreen","init"),this.loading=!0},methods:{changeFocus:function(e){this.$emit("inputFocus",e)},setNotice:function(e){this.notice=e},setLoading:function(e){this.loading=e},getImageBox:function(e){this.image_box=e,console.log(e)},inputText:function(){""!=this.input&&(this.$emit("input",this.input),this.input="")},setImage:function(e){this.image=e,this.loading=!1},readBox:function(){this.enable_select=!0},inputChar:function(e){this.$emit("inputChar",e)},confirmBox:function(){this.image_box&&(this.enable_select=!1,this.image_box.height=Math.trunc(this.image_box.height/this.scale),this.image_box.width=Math.trunc(this.image_box.width/this.scale),this.image_box.top=Math.trunc(this.image_box.top/this.scale),this.image_box.left=Math.trunc(this.image_box.left/this.scale),this.$emit("read",this.image_box))},clear:function(){this.$emit("clear")},getScreen:function(){this.$emit("getScreen"),this.loading=!0},goBack:function(){this.$emit("goBack")},home:function(){this.$emit("home")},swipeButton:function(e){var t=Math.trunc(this.screen_width/2),n=Math.trunc(this.screen_height/2),r=Math.trunc(this.screen_height/3),a=Math.trunc(this.screen_height/3*2),i=Math.trunc(this.screen_width/3*2),s=Math.trunc(this.screen_width/3);"left"==e?this.$emit("swipe",{x1:i,x2:s,y1:n,y2:n}):"right"==e?this.$emit("swipe",{x1:s,x2:i,y1:n,y2:n}):"up"==e?this.$emit("swipe",{x1:t,x2:t,y1:a,y2:r}):this.$emit("swipe",{x1:t,x2:t,y1:r,y2:a}),console.log(e)},swipeDirection:function(e,t,n,r){return Math.abs(e-t)>=Math.abs(n-r)?e-t>0?"左":"右":n-r>0?"上":"下"},longTap:function(){this.longTapTimeout=null,this.touch.last&&(this.touch.el.trigger("longTap"),this.touch={})},cancelLongTap:function(){this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.longTapTimeout=null},cancelAll:function(){this.touchTimeout&&clearTimeout(this.touchTimeout),this.tapTimeout&&clearTimeout(this.tapTimeout),this.swipeTimeout&&clearTimeout(this.swipeTimeout),this.longTapTimeout&&clearTimeout(this.longTapTimeout),this.touchTimeout=this.tapTimeout=this.swipeTimeout=this.longTapTimeout=null,this.touch={}},isPointerEventType:function(e,t){return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t},isPrimaryTouch:function(e){return("mouse"==e.pointerType||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary},touchstart:function(e){(this.isPointerType=this.isPointerEventType(e,"down"))&&!this.isPrimaryTouch(e)||(this.firstTouch=this.isPointerType?e:e.touches[0],e.touches&&1===e.touches.length&&this.touch.x2&&(this.touch.x2=void 0,this.touch.y2=void 0),this.now=Date.now(),this.delta=this.now-(this.touch.last||this.now),this.touch.el=this.$refs.image,this.touchTimeout&&clearTimeout(this.touchTimeout),this.touch.x1=this.firstTouch.offsetX,this.touch.y1=this.firstTouch.offsetY,this.delta>0&&this.delta<=250&&(this.touch.isDoubleTap=!0),this.touch.last=this.now,this.longTapTimeout=setTimeout(this.longTap,this.longTapDelay))},touchmove:function(e){(this.isPointerType=this.isPointerEventType(e,"move"))&&!this.isPrimaryTouch(e)||this.touch.x1&&(this.firstTouch=this.isPointerType?e:e.touches[0],this.cancelLongTap(),this.touch.x2=this.firstTouch.offsetX,this.touch.y2=this.firstTouch.offsetY,this.deltaX+=Math.abs(this.touch.x1-this.touch.x2),this.deltaY+=Math.abs(this.touch.y1-this.touch.y2))},touchend:function(e){var t=this;(this.isPointerType=this.isPointerEventType(e,"up"))&&!this.isPrimaryTouch(e)||(this.cancelLongTap(),this.touch.x2&&Math.abs(this.touch.x1-this.touch.x2)>30||this.touch.y2&&Math.abs(this.touch.y1-this.touch.y2)>30?this.swipeTimeout=setTimeout((function(){t.touch.el&&t.$emit("swipe",t.resetTouch(t.touch)),t.touch={}}),0):"last"in this.touch&&(this.deltaX<30&&this.deltaY<30?this.tapTimeout=setTimeout((function(){t.touch.isDoubleTap?(t.touch.el&&t.$emit("doubleTap",t.resetTouch(t.touch)),t.touch={}):t.touchTimeout=setTimeout((function(){t.touchTimeout=null,t.touch.el&&t.$emit("singleTap",t.resetTouch(t.touch)),t.touch={}}),250)}),0):this.touch={}),this.deltaX=this.deltaY=0)},resetTouch:function(e){return e.x1=Math.trunc(e.x1/this.scale),e.x2=Math.trunc(e.x2/this.scale),e.y1=Math.trunc(e.y1/this.scale),e.y2=Math.trunc(e.y2/this.scale),e}},components:{ImageSelector:H}},G=W,K=(n("d792"),Object(c["a"])(G,z,Y,!1,null,"67f07784",null)),Q=K.exports,Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.container_class,attrs:{id:"image-container"}},[n("h2",[e._v("截图列表")]),e._l(e.image_list,(function(t,r){return n("div",{key:r,staticClass:"image-item",class:{highlight:e.selected_index==r}},[n("el-row",{attrs:{type:"flex",justify:"center"}},[n("el-col",{attrs:{span:e.bigger?11:9}},[n("el-image",{style:e.image_style,attrs:{src:t.from,fit:"fill","preview-src-list":[t.from]}})],1),n("el-col",{attrs:{span:(e.bigger,4)}},[n("el-tooltip",{attrs:{effect:"dark",content:t.note,placement:"bottom",disabled:""==t.note}},[n("el-tag",{staticClass:"operation"},[e._v(e._s(""==t.operation?"等待操作":t.operation))])],1)],1),n("el-col",{attrs:{span:e.bigger?11:9}},[t.to?n("el-image",{style:e.image_style,attrs:{src:t.to,fit:"fill","preview-src-list":[t.to]}}):e._e()],1)],1),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.select(r)}}},[e._v("从下方插入"),n("i",{staticClass:"el-icon-refresh"})]),n("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.delete_image(r)}}},[e._v("删除"),n("i",{staticClass:"el-icon-refresh"})])],1)}))],2)},ee=[];n("a73a");function te(e){return new Promise((function(t){return setTimeout(t,e)}))}var ne={name:"ImageList",props:["bigger"],data:function(){return{image_list:[],selected_index:-1}},methods:{update_click:function(e,t){return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i,s,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=new Image,a=document.createElement("canvas"),r.src=e;case 3:if(0!=r.width){n.next=8;break}return n.next=6,te(100);case 6:n.next=3;break;case 8:return a.height=r.height,a.width=r.width,i=a.getContext("2d"),i.drawImage(r,0,0),i.strokeStyle="red",s=10,o=.25,i.strokeRect(t.x1*o-s/2,t.y1*o-s/2,s,s),n.abrupt("return",a.toDataURL("image/png"));case 17:case"end":return n.stop()}}),n)})))()},update_read:function(e,t){return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=new Image,r.src=e;case 2:if(0!=r.width){n.next=7;break}return n.next=5,te(100);case 5:n.next=2;break;case 7:return a=document.createElement("canvas"),a.height=r.height,a.width=r.width,i=a.getContext("2d"),i.drawImage(r,0,0),i.strokeStyle="red",s=.25,i.strokeRect(t.left*s,t.top*s,t.width*s,t.height*s),n.abrupt("return",a.toDataURL("image/png"));case 16:case"end":return n.stop()}}),n)})))()},add_image:function(e,t,n,r,a){var i=this;return Object(k["a"])(regeneratorRuntime.mark((function s(){var o,c,u,l;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(-1==i.selected_index){s.next=17;break}if(o=i.image_list[i.selected_index],c=i.selected_index,"点击"!=n){s.next=9;break}return s.next=6,i.update_click(o.from,a);case 6:o.from=s.sent,s.next=13;break;case 9:if("读取"!=n){s.next=13;break}return s.next=12,i.update_read(o.from,a);case 12:o.from=s.sent;case 13:o.to=e,o.operation=n,o.note=r,i.image_list.splice(c,1,o);case 17:return u=i.selected_index+1,i.selected_index=u,l={from:e,to:"",operation:"",note:"",image_id:t},i.image_list.splice(u,0,l),s.abrupt("return",1);case 22:case"end":return s.stop()}}),s)})))()},select:function(e){this.selected_index=e},delete_image:function(e){this.image_list.splice(e,1),this.selected_index>=this.image_list.length&&(this.selected_index=this.image_list.length-1)},clear_image:function(){this.image_list=[],this.selected_index=-1},replace_image:function(e){this.image_list=e},get_saved_image:function(){for(var e=[],t=0;t<this.image_list.length;t++)e.push(this.image_list[t].image_id);return e}},computed:{container_class:function(){return this.bigger?"image-container-bigger":"image-container"},image_style:function(){return this.bigger?{width:"320px",height:"560px",marginBottom:"5px"}:{width:"98px",height:"170px",marginBottom:"5px"}}}},re=ne,ae=(n("ede1"),Object(c["a"])(re,Z,ee,!1,null,null,null)),ie=ae.exports,se=(n("09f6"),n("73ef")),oe=n.n(se),ce=n("51c0"),ue=n.n(ce),le=n("7736"),de={namespaced:!0,state:{session:"",isLogin:!!localStorage["usn"],user:localStorage["usn"]||"",user_id:localStorage["user_id"]||"",token:localStorage["token"]||""},mutations:{setSession:function(e,t){e.session=t},setUser:function(e,t){e.user=t,e.user_id=t["user_id"],e.token=t["token"],e.isLogin=!0,localStorage["usn"]=t["usn"],localStorage["user_id"]=t["user_id"],localStorage["token"]=t["token"]},exitUser:function(e){e.user="",e.user_id="",e.token="",e.isLogin=!1,localStorage["usn"]="",localStorage["user_id"]="",localStorage["token"]=""}}},ge={namespaced:!0,state:{current_robot:localStorage["current_robot"]?JSON.parse(localStorage["current_robot"]):{}},mutations:{set_robot:function(e,t){e.current_robot=t,localStorage["current_robot"]=JSON.stringify(t)},edit_robot:function(e,t){e.current_robot=t,localStorage["current_robot"]=JSON.stringify(t)}}};r["default"].use(le["a"]);var he=new le["a"].Store({modules:{user:de,robot:ge}}),pe=oe.a.create(),me=!1,fe="";pe.interceptors.response.use((function(e){return-2==e.data["status"]&&(ce["Message"].error("认证失败"),he.commit("user/exitUser"),gt.replace("/dialog")),e.data}),(function(e){return console.log("连接出错",e),ce["Message"].error("系统出错"),{status:-3,error:"网络错误"}}));var _e=pe,be=fe+"/dialog",ve=function(e){if(me)return{status:1,response:e["message"]};var t=_e.post(be+"/chat",e);return t},xe=function(e){var t=_e.post("/doAction",e);return t},we=function(e){var t=_e.get("/getScreenshot?uid="+e["uid"]);return t},ke=function(e){var t=_e.get("/getDialog?dialog_id="+e["dialog_id"]);return t},ye=function(e){var t=_e.post("/startRecord",e);return t},Te=function(e){var t=_e.post("/endRecord",e);return t},$e=function(e){var t=_e.post("/reset",e);return t},Re=function(e){var t=_e.post("/save",e);return t},Le=function(e){var t=_e.post("/saveReview",e);return t},Ne=function(e){var t=_e.get("/getReview?uid=".concat(e["uid"],"&dialog=").concat(e["dialog"],"&turn=").concat(e["turn"]));return t},Oe=function(e){var t=_e.get("/getReviewDialog?uid="+e["uid"]);return t},Se=function(e){var t=_e.get("/getAllDialog?uid="+e["uid"]);return t},je=function(){var e=_e.get("/goalsGenerator");return e},Ie=function(e){var t=_e.get("/addDialog?dialog=".concat(e["dialog"],"&turn=").concat(e["turn"]));return t},Ce=function(e){var t=_e.get("/deleteDialog?dialog=".concat(e["dialog"],"&turn=").concat(e["turn"]));return t},Be={name:"Dialog",data:function(){return{input:"",status:"等待输入",input_focus:!1,dialog:[],full_dialog:[],all_dialog:[],image:null,enable_interact:!1,last_action:{},recording:!1,enable_change_dialog:!0,enable_save:!1,current_dialog_id:null,current_turn:0,current_user:"test",current_dialog:null,dialog_list:[],raw_images:[],layout_images:[],has_init:!1}},mounted:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$e({uid:e.current_user});case 2:return t.next=4,e.get_all_dialog(!0);case 4:document.body.addEventListener("keydown",e.handleSpace);case 5:case"end":return t.stop()}}),t)})))()},methods:{setImage:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.imageList.add_image(e.raw_images[0][0],e.raw_images[0][1]),n=1;case 2:if(!(n<e.raw_images.length)){t.next=8;break}return t.next=5,e.$refs.imageList.add_image(e.raw_images[n][0],e.raw_images[n][1],e.action[n-1]["action"],e.action[n-1]["text"],e.action[n-1]);case 5:n++,t.next=2;break;case 8:e.$refs.simulator.setLoading(!1);case 9:case"end":return t.stop()}}),t)})))()},getImages:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.simulator.setLoading(!0),e.$refs.imageList.clear_image(),n={uid:e.current_user,dialog:e.current_dialog_id,turn:e.current_turn},console.log("get image",n),t.next=6,Ne(n);case 6:r=t.sent,1==r["status"]&&(e.raw_images=r["image"],e.layout_images=r["layout"],e.action=r["action"],console.log("get image length:",e.raw_images.length),0!=e.raw_images.length?e.setImage():e.getScreenshot());case 8:case"end":return t.stop()}}),t)})))()},get_all_dialog:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Se({uid:t.current_user});case 2:if(r=n.sent,console.log(r),1==r["status"]){for(t.setNotice("已获取对话。"),a=-1,i=0;i<r["dialog"].length;i++)s=r["dialog"][i],s.check_status=s.annotated_turns+"/"+s.all_turns,s.color=s.annotated_turns==s.all_turns?"color-success":"color-info","color-info"==s.color&&-1==a&&(a=i);-1==a&&(a=0),t.all_dialog=r["dialog"],e&&(t.current_dialog=t.all_dialog[a],t.current_dialog_id=t.all_dialog[a].dialog_id)}e&&t.getDialog();case 6:case"end":return n.stop()}}),n)})))()},addTurn:function(){var e={text:"用户发言",isUser:!0},t=2*this.current_turn+2;t>=this.dialog.length&&(t=this.dialog.length),this.dialog.splice(t,0,e),e={text:"系统发言",isUser:!1},this.dialog.splice(t+1,0,e),this.full_dialog=this.dialog},deleteTurn:function(){var e=2*this.current_turn;this.dialog.splice(e,2),this.full_dialog=this.dialog},editTurn:function(e,t){var n=this.full_dialog[e];n.text=t,console.log(n),this.full_dialog.splice(e,1,n)},setInputFocus:function(e){this.input_focus=e,e?document.body.removeEventListener("keydown",this.handleSpace):document.body.addEventListener("keydown",this.handleSpace)},handleSpace:function(){var e=window.event.keyCode;32==e&&(window.event.preventDefault(),this.$refs.simulator.getScreen())},setNotice:function(e){this.$refs.simulator.setNotice(e)},saveImages:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("将保存所有标注的图片并加载下一轮对话，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.$refs.imageList.get_saved_image(),r={screens:n,dialog:e.full_dialog,dialog_id:e.current_dialog_id,turn:e.current_turn},t.next=4,Re(r);case 4:a=t.sent,1==a["status"]&&(e.setNotice("保存成功"),e.get_all_dialog(!1),e.getNextTurn());case 6:case"end":return t.stop()}}),t)}))));case 1:case"end":return t.stop()}}),t)})))()},startRecording:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact=!0,e.recording=!0,e.enable_change_dialog=!1,e.enable_save=!0,0==e.current_turn)for(e.dialog=[],n=0;n<2;n++)r=e.full_dialog[n],e.update_history(r,r.isUser);return t.next=7,ye({uid:e.current_user});case 7:a=t.sent,1==a["status"]&&(e.setNotice("开始录制，请在网页上操作手机，所有操作将会被记录。"),e.$message({message:"开始录制",type:"success"}));case 9:case"end":return t.stop()}}),t)})))()},endRecording:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Te({uid:e.current_user,dialog:e.current_dialog_id});case 2:n=t.sent,1==n["status"]&&(e.setNotice("结束录制，请在右侧确认截图列表。"),e.$message({message:"录制成功",type:"success"})),e.recording=!1;case 5:case"end":return t.stop()}}),t)})))()},changeDialog:function(e){this.current_dialog_id=e.dialog_id,this.getDialog()},getDialog:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.setNotice("获取对话中"),t.next=3,ke({dialog_id:e.current_dialog_id});case 3:if(n=t.sent,1==n["status"]){for(e.setNotice("已获取对话，可根据对话在手机上探索，准备好后点击开始录制进行操作录制。"),e.full_dialog=n["turns"],e.dialog=[],r=0;r<n["turns"].length;r++)a=n["turns"][r],e.update_history(a,a.isUser);e.current_dialog_id=n["id"],e.current_turn=0,e.getImages()}else e.setNotice("所有对话已经标注完毕。"),e.$message("所有对话已经标注完毕。");case 5:case"end":return t.stop()}}),t)})))()},lastTurn:function(){this.setNotice("正在切换至上一轮对话。"),0!=this.current_turn&&(this.current_turn-=1,this.getImages())},getNextTurn:function(){var e=this;this.setNotice("正在获取下一轮对话。"),console.log(this.current_turn),console.log(this.full_dialog);var t=2*(this.current_turn+1);console.log("next index",t,"full dialog",this.full_dialog.length),t<this.full_dialog.length?(this.current_turn+=1,this.getImages(),this.setNotice("已获取对话，可根据对话在手机上探索，准备好后点击开始录制进行操作录制。")):(this.enable_change_dialog=!0,this.enable_save=!1,this.$alert("当前对话已经标注完毕，即将跳转到下一个对话。","已完成",{confirmButtonText:"确定",callback:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Te({uid:e.current_user});case 2:if(n=t.sent,1==n["status"]){for(r=-1,a=0;a<e.all_dialog.length;a++)i=e.all_dialog[a],"color-info"==i.color&&-1==r&&(r=a);-1==r&&(r=0),e.current_dialog=e.all_dialog[r],e.current_dialog_id=e.all_dialog[r].dialog_id,e.getDialog()}case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()}))},clearInput:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("清除输入执行中"),n={type:"clear"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("清除输入执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"清除输入",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},inputChar:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return r="",r="space"==e?"空格":"回车",t.setNotice("输入"+r),a={type:e},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=10,xe({uid:t.current_user,action:a});case 10:i=n.sent,1==i["status"]&&(t.setNotice("已输入"+r+", 请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:r,note:"",touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(a,"done"));case 12:case"end":return n.stop()}}),n)})))()},readBox:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("添加读取框中"),r={type:"read",height:e.height,width:e.width,top:e.top,left:e.left},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=8,xe({uid:t.current_user,action:r});case 8:a=n.sent,1==a["status"]&&(t.setNotice("已添加读取框，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"读取",note:"",touch:e},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 10:case"end":return n.stop()}}),n)})))()},inputText:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("输入文字执行中"),r={type:"input",text:e},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=8,xe({uid:t.current_user,action:r});case 8:a=n.sent,1==a["status"]&&(t.setNotice("输入文字完成，输入内容："+e+"，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"输入",note:e,touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 10:case"end":return n.stop()}}),n)})))()},goBack:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("执行返回键"),n={type:"back"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("返回执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"返回",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},home:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("执行home键"),n={type:"home"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("返回执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"返回",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},swipe:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("执行滑动操作。"),console.log("swipe",e),t.$refs.simulator.setLoading(!0),t.enable_interact=!1,r={type:"swipe",x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},n.next=9,xe({uid:t.current_user,action:r});case 9:a=n.sent,1==a["status"]&&(i=t.$refs.simulator.swipeDirection(e.x1,e.x2,e.y1,e.y2),t.setNotice(i+"滑执行完毕，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:i+"滑",note:"",touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 11:case"end":return n.stop()}}),n)})))()},singleTap:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("点击执行中"),console.log("single tap",e),t.$refs.simulator.setLoading(!0),t.enable_interact=!1,r={type:"click",x:e.x1,y:e.y1},n.next=9,xe({uid:t.current_user,action:r});case 9:a=n.sent,1==a["status"]&&(t.setNotice("点击执行完毕，点击位置："+e.x1+","+e.y1+",请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"点击",note:"点击位置："+e.x1+","+e.y1,touch:e},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(t.enable_interact),console.log(r,"done"));case 11:case"end":return n.stop()}}),n)})))()},doubleTap:function(e){console.log("double tap",e)},getScreenshot:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.enable_interact=!1,t.setNotice("获取截图中，请勿进行操作。"),t.$refs.simulator.setLoading(!0),n.next=5,we({uid:t.current_user});case 5:r=n.sent,console.log(r),1==r["status"]&&(t.setNotice("获取截图完毕，可以进行下一步操作。"),t.$refs.simulator.setImage(r["screenshot"]),"init"!=e&&t.$refs.imageList.add_image(r["screenshot"],r["screen_id"],t.last_action["op"],t.last_action["note"],t.last_action["touch"]),t.$refs.simulator.setLoading(!1)),t.enable_interact=!0;case 9:case"end":return n.stop()}}),n)})))()},update_history:function(e,t){e["isUser"]=t,this.dialog.push(e)},send_message:function(e){var t=arguments,n=this;return Object(k["a"])(regeneratorRuntime.mark((function r(){var a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t.length>1&&void 0!==t[1]?t[1]:null,console.log("send",e),r.next=4,ve({message:e,data:a});case 4:if(i=r.sent,console.log("receive:",i),1!=i["status"]){r.next=14;break}if(!i["execute_task"]){r.next=10;break}return n.playback_status.has_loaded||(n.update_history({text:i["response"]},!1),n.status="begin to perform task",n.playback_status.has_loaded=!0,n.session_on&&n.$refs.simulator.endSession(),n.$refs.simulator.requestSession()),r.abrupt("return");case 10:n.update_history({text:i["response"]},!1),n.status="success",r.next=15;break;case 14:n.status="fail";case 15:case"end":return r.stop()}}),r)})))()},submit:function(){var e=this.input;if(e){if(this.status="updating dom",this.input="",this.update_history({text:e},!0),this.status="sending message",console.log(e),e.startsWith("输入")){var t=e.slice(2);return console.log("输入：",t),void this.$refs.simulator.pasteText(t)}this.send_message(e)}}},components:{Talk:U,ImageSimulator:Q,ImageList:ie}},Me=Be,De=(n("955c"),Object(c["a"])(Me,x,w,!1,null,"9f2560f8",null)),Ee=De.exports,Pe={components:{Dialog:Ee}},Fe=Pe,Ue=(n("dcca"),Object(c["a"])(Fe,b,v,!1,null,"38a42067",null)),ze=Ue.exports,Ye=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("div",{staticClass:"dialogPage-dialog"},[n("Dialog")],1)])},Xe=[],Ae=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",[n("el-col",{attrs:{span:9}},[n("div",{staticClass:"dialog-main"},[n("div",{staticClass:"dialog-header"},[n("el-button",{staticClass:"el-icon-refresh",staticStyle:{"margin-bottom":"5px"},attrs:{type:"primary",size:"small"},on:{click:e.get_goal}},[e._v(" 换个目标 ")]),n("h4",[e._v("对话目标:")]),n("p",{domProps:{innerHTML:e._s(e.goals)}}),n("br"),n("h4",[e._v("对话必须涉及:")]),n("p",{domProps:{innerHTML:e._s(e.lan_infos)}})],1),n("div",[n("el-button-group",[n("el-button",{attrs:{type:"primary"},on:{click:e.lastTurn}},[e._v(" 上一轮 ")]),n("el-button",{attrs:{type:"primary"},on:{click:e.getNextTurn}},[e._v(" 下一轮 ")]),n("el-dropdown",{attrs:{"split-button":"",type:"plain"},on:{command:e.addTurn,click:function(t){return e.addTurn("down")}}},[e._v(" 加一轮 "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"down"}},[e._v("在下方添加")]),n("el-dropdown-item",{attrs:{command:"up"}},[e._v("在上方添加")]),n("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除当前轮")])],1)],1),n("el-button",{attrs:{type:"success",disabled:e.enable_save},on:{click:e.saveImages}},[e._v("保存 "),n("i",{staticClass:"el-icon-video-pause"})])],1),n("el-select",{attrs:{disabled:!e.enable_change_dialog,"value-key":"name",placeholder:"对话id"},on:{change:e.changeDialog},model:{value:e.current_dialog,callback:function(t){e.current_dialog=t},expression:"current_dialog"}},e._l(e.all_dialog,(function(t,r){return n("el-option",{key:r,attrs:{label:t.name,value:t}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),n("span",{class:t.color,staticStyle:{float:"right","font-size":"13px"}},[e._v(e._s(t.check_status))])])})),1)],1),n("div",{staticClass:"dialog-dialog",attrs:{id:"dialog-window"}},e._l(e.dialog,(function(t,r){return n("Talk",{key:r,attrs:{data:t,index:r,selected:r>=2*e.current_turn&&r<=2*e.current_turn+1},on:{editTurn:e.editTurn,inputFocus:e.setInputFocus}})})),1)])]),n("el-col",{attrs:{span:10}},[n("ImageSimulator",{ref:"simulator",attrs:{image:e.image},on:{swipe:e.swipe,doubleTap:e.doubleTap,singleTap:e.singleTap,getScreen:e.getScreenshot,goBack:e.goBack,home:e.home,input:e.inputText,inputFocus:e.setInputFocus,clear:e.clearInput,read:e.readBox,inputChar:e.inputChar}})],1),n("el-col",{attrs:{span:5}},[n("ImageList",{ref:"imageList"})],1)],1)},Je=[],Ve={name:"Dialog",data:function(){return{input:"",status:"等待输入",input_focus:!1,dialog:[],full_dialog:[],all_dialog:[],image:null,enable_interact:!1,last_action:{},recording:!1,enable_change_dialog:!0,enable_save:!1,current_dialog_id:null,current_turn:0,current_user:"test",current_dialog:null,dialog_list:[],raw_images:[],layout_images:[],has_init:!1,goals:"",lan_infos:""}},mounted:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$e({uid:e.current_user});case 2:return t.next=4,e.get_all_dialog(!0);case 4:document.body.addEventListener("keydown",e.handleSpace);case 5:case"end":return t.stop()}}),t)})))()},methods:{get_goal:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,je();case 2:n=t.sent,1==n["status"]&&(e.goals=n["goals"],e.lan_infos=n["lan_infos"]);case 4:case"end":return t.stop()}}),t)})))()},setImage:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.imageList.add_image(e.raw_images[0][0],e.raw_images[0][1]),n=1;case 2:if(!(n<e.raw_images.length)){t.next=8;break}return t.next=5,e.$refs.imageList.add_image(e.raw_images[n][0],e.raw_images[n][1],e.action[n-1]["action"],e.action[n-1]["text"],e.action[n-1]);case 5:n++,t.next=2;break;case 8:e.$refs.simulator.setLoading(!1);case 9:case"end":return t.stop()}}),t)})))()},getImages:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.simulator.setLoading(!0),e.$refs.imageList.clear_image(),n={uid:e.current_user,dialog:e.current_dialog_id,turn:e.current_turn},console.log("get image",n),t.next=6,Ne(n);case 6:r=t.sent,1==r["status"]&&(e.raw_images=r["image"],e.layout_images=r["layout"],e.action=r["action"],e.goals=r["goals"],e.lan_infos=r["lan_infos"],console.log("get image length:",e.raw_images.length),0!=e.raw_images.length?e.setImage():e.getScreenshot());case 8:case"end":return t.stop()}}),t)})))()},get_all_dialog:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Se({uid:t.current_user});case 2:if(r=n.sent,console.log(r),1==r["status"]){for(t.setNotice("已获取对话。"),a=-1,i=0;i<r["dialog"].length;i++)s=r["dialog"][i],s.check_status=s.annotated_turns+"/"+s.all_turns,s.color=s.annotated_turns==s.all_turns?"color-success":"color-info","color-info"==s.color&&-1==a&&(a=i);-1==a&&(a=0),t.all_dialog=r["dialog"],e&&(t.current_dialog=t.all_dialog[a],t.current_dialog_id=t.all_dialog[a].dialog_id)}e&&t.getDialog();case 6:case"end":return n.stop()}}),n)})))()},addTurn:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("delete"!=e){n.next=3;break}return t.deleteTurn(),n.abrupt("return");case 3:return r={text:"用户发言",isUser:!0},a=2*t.current_turn+2,a>=t.dialog.length&&(a=t.dialog.length),"up"==e&&(a=2*t.current_turn),i={dialog:t.current_dialog_id},i["turn"]="down"==e?t.current_turn+1:t.current_turn,n.next=11,Ie(i);case 11:s=n.sent,1==s["status"]&&(t.dialog.splice(a,0,r),r={text:"系统发言",isUser:!1},t.dialog.splice(a+1,0,r),t.full_dialog=t.dialog,"up"==e&&(t.current_turn+=1));case 13:case"end":return n.stop()}}),n)})))()},deleteTurn:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("删除当前轮对话将清除当前轮所有标注的图片，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=2*e.current_turn,r={dialog:e.current_dialog_id,turn:e.current_turn},t.next=4,Ce(r);case 4:a=t.sent,1==a["status"]&&(e.dialog.splice(n,2),e.full_dialog=e.dialog,2*e.current_turn>=e.dialog.length&&(e.current_turn-=1),e.getImages());case 6:case"end":return t.stop()}}),t)}))));case 1:case"end":return t.stop()}}),t)})))()},editTurn:function(e,t){var n=this.full_dialog[e];n.text=t,console.log(n),this.full_dialog.splice(e,1,n)},setInputFocus:function(e){this.input_focus=e,e?document.body.removeEventListener("keydown",this.handleSpace):document.body.addEventListener("keydown",this.handleSpace)},handleSpace:function(){var e=window.event.keyCode;32==e&&(window.event.preventDefault(),this.$refs.simulator.getScreen())},setNotice:function(e){this.$refs.simulator.setNotice(e)},saveImages:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm("将保存所有标注的图片并加载下一轮对话，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.$refs.imageList.get_saved_image(),r={screens:n,dialog:e.full_dialog,dialog_id:e.current_dialog_id,turn:e.current_turn,goals:e.goals,lan_infos:e.lan_infos},t.next=4,Re(r);case 4:a=t.sent,1==a["status"]&&(e.setNotice("保存成功"),e.get_all_dialog(!1),e.getNextTurn());case 6:case"end":return t.stop()}}),t)}))));case 1:case"end":return t.stop()}}),t)})))()},startRecording:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact=!0,e.recording=!0,e.enable_change_dialog=!1,e.enable_save=!0,0==e.current_turn)for(e.dialog=[],n=0;n<2;n++)r=e.full_dialog[n],e.update_history(r,r.isUser);return t.next=7,ye({uid:e.current_user});case 7:a=t.sent,1==a["status"]&&(e.setNotice("开始录制，请在网页上操作手机，所有操作将会被记录。"),e.$message({message:"开始录制",type:"success"}));case 9:case"end":return t.stop()}}),t)})))()},endRecording:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Te({uid:e.current_user,dialog:e.current_dialog_id});case 2:n=t.sent,1==n["status"]&&(e.setNotice("结束录制，请在右侧确认截图列表。"),e.$message({message:"录制成功",type:"success"})),e.recording=!1;case 5:case"end":return t.stop()}}),t)})))()},changeDialog:function(e){this.current_dialog_id=e.dialog_id,this.getDialog()},getDialog:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.setNotice("获取对话中"),t.next=3,ke({dialog_id:e.current_dialog_id});case 3:if(n=t.sent,1==n["status"]){for(e.setNotice("已获取对话，可根据对话在手机上探索，准备好后点击开始录制进行操作录制。"),e.full_dialog=n["turns"],e.dialog=[],r=0;r<n["turns"].length;r++)a=n["turns"][r],e.update_history(a,a.isUser);e.current_dialog_id=n["id"],e.current_turn=0,e.getImages()}else e.setNotice("所有对话已经标注完毕。"),e.$message("所有对话已经标注完毕。");case 5:case"end":return t.stop()}}),t)})))()},lastTurn:function(){this.setNotice("正在切换至上一轮对话。"),0!=this.current_turn&&(this.current_turn-=1,this.getImages())},getNextTurn:function(){var e=this;this.setNotice("正在获取下一轮对话。"),console.log(this.current_turn),console.log(this.full_dialog);var t=2*(this.current_turn+1);console.log("next index",t,"full dialog",this.full_dialog.length),t<this.full_dialog.length?(this.current_turn+=1,this.getImages(),this.setNotice("已获取对话，可根据对话在手机上探索，准备好后点击开始录制进行操作录制。")):(this.enable_change_dialog=!0,this.enable_save=!1,this.$alert("当前对话已经标注完毕，即将跳转到下一个对话。","已完成",{confirmButtonText:"确定",callback:function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Te({uid:e.current_user});case 2:if(n=t.sent,1==n["status"]){for(r=-1,a=0;a<e.all_dialog.length;a++)i=e.all_dialog[a],"color-info"==i.color&&-1==r&&(r=a);-1==r&&(r=0),e.current_dialog=e.all_dialog[r],e.current_dialog_id=e.all_dialog[r].dialog_id,e.getDialog()}case 4:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()}))},clearInput:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("清除输入执行中"),n={type:"clear"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("清除输入执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"清除输入",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},inputChar:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return r="",r="space"==e?"空格":"回车",t.setNotice("输入"+r),a={type:e},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=10,xe({uid:t.current_user,action:a});case 10:i=n.sent,1==i["status"]&&(t.setNotice("已输入"+r+", 请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:r,note:"",touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(a,"done"));case 12:case"end":return n.stop()}}),n)})))()},readBox:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("添加读取框中"),r={type:"read",height:e.height,width:e.width,top:e.top,left:e.left},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=8,xe({uid:t.current_user,action:r});case 8:a=n.sent,1==a["status"]&&(t.setNotice("已添加读取框，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"读取",note:"",touch:e},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 10:case"end":return n.stop()}}),n)})))()},inputText:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("输入文字执行中"),r={type:"input",text:e},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=8,xe({uid:t.current_user,action:r});case 8:a=n.sent,1==a["status"]&&(t.setNotice("输入文字完成，输入内容："+e+"，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"输入",note:e,touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 10:case"end":return n.stop()}}),n)})))()},goBack:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("执行返回键"),n={type:"back"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("返回执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"返回",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},home:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("执行home键"),n={type:"home"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("返回执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"返回",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},swipe:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("执行滑动操作。"),console.log("swipe",e),t.$refs.simulator.setLoading(!0),t.enable_interact=!1,r={type:"swipe",x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},n.next=9,xe({uid:t.current_user,action:r});case 9:a=n.sent,1==a["status"]&&(i=t.$refs.simulator.swipeDirection(e.x1,e.x2,e.y1,e.y2),t.setNotice(i+"滑执行完毕，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:i+"滑",note:"",touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 11:case"end":return n.stop()}}),n)})))()},singleTap:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("点击执行中"),console.log("single tap",e),t.$refs.simulator.setLoading(!0),t.enable_interact=!1,r={type:"click",x:e.x1,y:e.y1},n.next=9,xe({uid:t.current_user,action:r});case 9:a=n.sent,1==a["status"]&&(t.setNotice("点击执行完毕，点击位置："+e.x1+","+e.y1+",请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"点击",note:"点击位置："+e.x1+","+e.y1,touch:e},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(t.enable_interact),console.log(r,"done"));case 11:case"end":return n.stop()}}),n)})))()},doubleTap:function(e){console.log("double tap",e)},getScreenshot:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.enable_interact=!1,t.setNotice("获取截图中，请勿进行操作。"),t.$refs.simulator.setLoading(!0),n.next=5,we({uid:t.current_user});case 5:r=n.sent,console.log(r),1==r["status"]&&(t.setNotice("获取截图完毕，可以进行下一步操作。"),t.$refs.simulator.setImage(r["screenshot"]),"init"!=e&&t.$refs.imageList.add_image(r["screenshot"],r["screen_id"],t.last_action["op"],t.last_action["note"],t.last_action["touch"]),t.$refs.simulator.setLoading(!1)),t.enable_interact=!0;case 9:case"end":return n.stop()}}),n)})))()},update_history:function(e,t){e["isUser"]=t,this.dialog.push(e)},send_message:function(e){var t=arguments,n=this;return Object(k["a"])(regeneratorRuntime.mark((function r(){var a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t.length>1&&void 0!==t[1]?t[1]:null,console.log("send",e),r.next=4,ve({message:e,data:a});case 4:if(i=r.sent,console.log("receive:",i),1!=i["status"]){r.next=14;break}if(!i["execute_task"]){r.next=10;break}return n.playback_status.has_loaded||(n.update_history({text:i["response"]},!1),n.status="begin to perform task",n.playback_status.has_loaded=!0,n.session_on&&n.$refs.simulator.endSession(),n.$refs.simulator.requestSession()),r.abrupt("return");case 10:n.update_history({text:i["response"]},!1),n.status="success",r.next=15;break;case 14:n.status="fail";case 15:case"end":return r.stop()}}),r)})))()},submit:function(){var e=this.input;if(e){if(this.status="updating dom",this.input="",this.update_history({text:e},!0),this.status="sending message",console.log(e),e.startsWith("输入")){var t=e.slice(2);return console.log("输入：",t),void this.$refs.simulator.pasteText(t)}this.send_message(e)}}},components:{Talk:U,ImageSimulator:Q,ImageList:ie}},qe=Ve,He=(n("ef7c"),Object(c["a"])(qe,Ae,Je,!1,null,"56690cf0",null)),We=He.exports,Ge={components:{Dialog:We}},Ke=Ge,Qe=(n("3e1a"),Object(c["a"])(Ke,Ye,Xe,!1,null,"5f6e4c7b",null)),Ze=Qe.exports,et=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("div",{staticClass:"dialogPage-dialog"},[n("Review")],1)])},tt=[],nt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",[n("el-col",{attrs:{span:8}},[n("div",{staticClass:"dialog-main"},[n("div",{staticClass:"dialog-header"},[n("el-select",{attrs:{"value-key":"name",placeholder:"对话id"},on:{change:e.getDialog},model:{value:e.current_dialog,callback:function(t){e.current_dialog=t},expression:"current_dialog"}},e._l(e.dialog_list,(function(t,r){return n("el-option",{key:r,attrs:{label:t.name,value:t}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.check_status))])])})),1),e._v(" 当前轮数:"+e._s(e.current_turn)+" "),n("el-button",{attrs:{type:"success"},on:{click:function(t){return e.saveImages(1)}}},[e._v("通过 "),n("i",{staticClass:"el-icon-check"})]),n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.saveImages(0)}}},[e._v("不通过 "),n("i",{staticClass:"el-icon-close"})])],1),n("el-button-group",[n("el-button",{attrs:{type:"primary"},on:{click:e.lastTurn}},[e._v(" 上一轮 ")]),n("el-button",{attrs:{type:"primary"},on:{click:e.nextTurn}},[e._v(" 下一轮 ")]),n("el-button",{attrs:{type:"warning"},on:{click:e.changeViewMode}},[e._v("切换审核模式 "),n("i",{staticClass:"el-icon-refresh"})]),n("el-button",{attrs:{type:"plain"},on:{click:e.changeViewLayout}},[e._v("切换图片模式 "),n("i",{staticClass:"el-icon-refresh"})])],1),n("div",{staticClass:"dialog-dialog",attrs:{id:"dialog-window"}},e._l(e.dialog,(function(t,r){return n("Talk",{key:r,attrs:{data:t,index:r,selected:r>=2*e.current_turn&&r<=2*e.current_turn+1},on:{editTurn:e.editTurn,inputFocus:e.setInputFocus}})})),1)],1)]),e.viewmode?n("el-col",{attrs:{span:16}},[n("ImageList",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"imageList",attrs:{bigger:!0}})],1):e._e(),e.viewmode?e._e():n("el-col",{attrs:{span:10}},[n("ImageSimulator",{ref:"simulator",attrs:{image:e.image},on:{swipe:e.swipe,doubleTap:e.doubleTap,singleTap:e.singleTap,getScreen:e.getScreenshot,goBack:e.goBack,input:e.inputText,inputFocus:e.setInputFocus,clear:e.clearInput,read:e.readBox,inputChar:e.inputChar}})],1),e.viewmode?e._e():n("el-col",{attrs:{span:6}},[n("ImageList",{ref:"imageList"})],1)],1)},rt=[],at=(n("3d83"),{name:"Dialog",data:function(){return{input:"",status:"等待输入",input_focus:!1,dialog:[],full_dialog:[],image:null,enable_interact:!1,last_action:{},recording:!1,enable_change_dialog:!0,enable_save:!1,current_dialog_id:null,current_dialog:null,current_user:"test",current_turn:0,dialog_list:[],raw_images:[],layout_images:[],viewmode:!0,loading:!1,viewLayout:!1}},mounted:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$e({uid:e.current_user});case 2:return t.next=4,Oe({uid:e.current_user});case 4:if(n=t.sent,console.log(n),1==n["status"]){for(e.setNotice("已获取对话。"),r=-1,a=0;a<n["dialog"].length;a++)i=n["dialog"][a],1==i.check_status?i.check_status="通过":0==i.check_status?i.check_status="未通过":(i.check_status="",-1==r&&(r=a));-1==r&&(r=0),e.dialog_list=n["dialog"],e.current_dialog_id=e.dialog_list[r].dialog_id,e.current_dialog=e.dialog_list[r],e.getDialog(e.current_dialog)}document.body.addEventListener("keydown",e.handleSpace);case 8:case"end":return t.stop()}}),t)})))()},methods:{changeViewLayout:function(){this.viewLayout=!this.viewLayout,this.getImages()},changeViewMode:function(){this.viewmode=!this.viewmode,this.viewmode&&this.getImages()},editTurn:function(e,t){var n=this.dialog[e];n.text=t,console.log(n),this.dialog.splice(e,1,n)},setInputFocus:function(e){this.input_focus=e,e?document.body.removeEventListener("keydown",this.handleSpace):document.body.addEventListener("keydown",this.handleSpace)},handleSpace:function(){var e=window.event.keyCode;32==e&&(window.event.preventDefault(),this.$refs.simulator.getScreen())},setNotice:function(e){this.viewmode||this.$refs.simulator.setNotice(e)},saveImages:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r="",r=1==e?"将当前对话标记为通过，保存所有标注的图片并加载下一轮对话，是否继续？":"将当前对话标记为不通过并加载下一轮对话，是否继续？",t.$confirm(r,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.current_dialog.check_status=1==e?"通过":"未通过",r=t.$refs.imageList.get_saved_image(),a={screens:r,dialog:t.dialog,trace:t.current_dialog.name,turn:t.current_turn,check_status:e},n.next=5,Le(a);case 5:i=n.sent,1==i["status"]&&(t.setNotice("保存成功"),t.nextTurn());case 7:case"end":return n.stop()}}),n)}))));case 3:case"end":return n.stop()}}),n)})))()},setImage:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.imageList.add_image(e.shown_images[0][0],e.shown_images[0][1]),n=1;case 2:if(!(n<e.shown_images.length)){t.next=8;break}return t.next=5,e.$refs.imageList.add_image(e.shown_images[n][0],e.shown_images[n][1],e.action[n-1]["action"],e.action[n-1]["text"],e.action[n-1]);case 5:n++,t.next=2;break;case 8:case"end":return t.stop()}}),t)})))()},getImages:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.imageList.clear_image(),e.loading=!0,n={uid:e.current_user,dialog:e.current_dialog_id,turn:e.current_turn},console.log("get image",n),t.next=6,Ne(n);case 6:r=t.sent,1==r["status"]&&(e.raw_images=r["image"],e.layout_images=r["layout"],e.action=r["action"],e.setImage()),e.loading=!1;case 9:case"end":return t.stop()}}),t)})))()},getDialog:function(e){this.current_dialog_id=e.dialog_id,this.current_dialog=e,this.current_turn=0,this.dialog=[];for(var t=0;t<this.current_dialog.dialog.length;t++){var n=this.current_dialog.dialog[t];this.update_history(n,n.isUser)}this.getImages(),console.log("change to",this.current_dialog)},lastTurn:function(){this.setNotice("正在切换至上一轮对话。"),0!=this.current_turn&&(this.current_turn-=1,this.getImages())},nextTurn:function(){var e=this;this.setNotice("正在切换至下一轮对话。");var t=2*(this.current_turn+1);t<this.current_dialog.dialog.length?(this.current_turn+=1,this.getImages()):(this.enable_save=!1,this.$alert("当前对话已经检查完毕，即将跳转到下一个对话。","已完成",{confirmButtonText:"确定",callback:function(){for(var t=-1,n=0;n<e.dialog_list.length;n++)if(""==e.dialog_list[n].check_status){t=n;break}-1==t&&(t=0),e.current_dialog_id=e.dialog_list[t].dialog_id,e.current_dialog=e.dialog_list[t],e.getDialog(e.current_dialog),e.$refs.imageList.clear_image()}}))},clearInput:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("清除输入执行中"),n={type:"clear"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("清除输入执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"清除输入",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},inputChar:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return r="",r="space"==e?"空格":"回车",t.setNotice("输入"+r),a={type:e},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=10,xe({uid:t.current_user,action:a});case 10:i=n.sent,1==i["status"]&&(t.setNotice("已输入"+r+", 请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:r,note:"",touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(a,"done"));case 12:case"end":return n.stop()}}),n)})))()},readBox:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("添加读取框中"),r={type:"read",height:e.height,width:e.width,top:e.top,left:e.left},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=8,xe({uid:t.current_user,action:r});case 8:a=n.sent,1==a["status"]&&(t.setNotice("已添加读取框，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"读取",note:"",touch:e},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 10:case"end":return n.stop()}}),n)})))()},inputText:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("输入文字执行中"),r={type:"input",text:e},t.$refs.simulator.setLoading(!0),t.enable_interact=!1,n.next=8,xe({uid:t.current_user,action:r});case 8:a=n.sent,1==a["status"]&&(t.setNotice("输入文字完成，输入内容："+e+"，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"输入",note:e,touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 10:case"end":return n.stop()}}),n)})))()},goBack:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.enable_interact){t.next=2;break}return t.abrupt("return");case 2:return e.setNotice("执行返回键"),n={type:"back"},e.$refs.simulator.setLoading(!0),e.enable_interact=!1,t.next=8,xe({uid:e.current_user,action:n});case 8:r=t.sent,1==r["status"]&&(e.setNotice("返回执行完毕，请点击截图按钮或者使用空格键进行截图。"),e.last_action={op:"返回",note:"",touch:null},e.$refs.simulator.setLoading(!1),e.enable_interact=!0,console.log(n,"done"));case 10:case"end":return t.stop()}}),t)})))()},swipe:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("执行滑动操作。"),console.log("swipe",e),t.$refs.simulator.setLoading(!0),t.enable_interact=!1,r={type:"swipe",x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},n.next=9,xe({uid:t.current_user,action:r});case 9:a=n.sent,1==a["status"]&&(i=t.$refs.simulator.swipeDirection(e.x1,e.x2,e.y1,e.y2),t.setNotice(i+"滑执行完毕，请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:i+"滑",note:"",touch:null},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(r,"done"));case 11:case"end":return n.stop()}}),n)})))()},singleTap:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.enable_interact){n.next=2;break}return n.abrupt("return");case 2:return t.setNotice("点击执行中"),console.log("single tap",e),t.$refs.simulator.setLoading(!0),t.enable_interact=!1,r={type:"click",x:e.x1,y:e.y1},n.next=9,xe({uid:t.current_user,action:r});case 9:a=n.sent,1==a["status"]&&(t.setNotice("点击执行完毕，点击位置："+e.x1+","+e.y1+",请点击截图按钮或者使用空格键进行截图。"),t.last_action={op:"点击",note:"点击位置："+e.x1+","+e.y1,touch:e},t.$refs.simulator.setLoading(!1),t.enable_interact=!0,console.log(t.enable_interact),console.log(r,"done"));case 11:case"end":return n.stop()}}),n)})))()},doubleTap:function(e){console.log("double tap",e)},getScreenshot:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.viewmode){t.next=2;break}return t.abrupt("return");case 2:return e.enable_interact=!1,e.setNotice("获取截图中，请勿进行操作。"),e.$refs.simulator.setLoading(!0),t.next=7,we({uid:e.current_user});case 7:n=t.sent,console.log(n),1==n["status"]&&(e.setNotice("获取截图完毕，可以进行下一步操作。"),e.$refs.simulator.setImage(n["screenshot"]),e.$refs.imageList.add_image(n["screenshot"],n["screen_id"],e.last_action["op"],e.last_action["note"],e.last_action["touch"]),e.$refs.simulator.setLoading(!1)),e.enable_interact=!0;case 11:case"end":return t.stop()}}),t)})))()},update_history:function(e,t){e["isUser"]=t,this.dialog.push(e)},send_message:function(e){var t=arguments,n=this;return Object(k["a"])(regeneratorRuntime.mark((function r(){var a,i;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t.length>1&&void 0!==t[1]?t[1]:null,console.log("send",e),r.next=4,ve({message:e,data:a});case 4:if(i=r.sent,console.log("receive:",i),1!=i["status"]){r.next=14;break}if(!i["execute_task"]){r.next=10;break}return n.playback_status.has_loaded||(n.update_history({text:i["response"]},!1),n.status="begin to perform task",n.playback_status.has_loaded=!0,n.session_on&&n.$refs.simulator.endSession(),n.$refs.simulator.requestSession()),r.abrupt("return");case 10:n.update_history({text:i["response"]},!1),n.status="success",r.next=15;break;case 14:n.status="fail";case 15:case"end":return r.stop()}}),r)})))()},submit:function(){var e=this.input;if(e){if(this.status="updating dom",this.input="",this.update_history({text:e},!0),this.status="sending message",console.log(e),e.startsWith("输入")){var t=e.slice(2);return console.log("输入：",t),void this.$refs.simulator.pasteText(t)}this.send_message(e)}}},computed:{shown_images:function(){return this.viewLayout?this.layout_images:this.raw_images}},components:{Talk:U,ImageSimulator:Q,ImageList:ie}}),it=at,st=(n("b354"),Object(c["a"])(it,nt,rt,!1,null,"a2740d76",null)),ot=st.exports,ct={components:{Review:ot}},ut=ct,lt=(n("6a7e"),Object(c["a"])(ut,et,tt,!1,null,"a8bef2b2",null)),dt=lt.exports;r["default"].use(d["a"]);var gt=new d["a"]({routes:[{path:"/",name:"Base",component:_,children:[{path:"/dialog",name:"DialogPage",component:ze},{path:"review",name:"ReviewPage",component:dt},{path:"new",name:"NewDialogPage",component:Ze}]}]});n("52d1");r["default"].use(ue.a),r["default"].config.productionTip=!1,new r["default"]({router:gt,store:he,render:function(e){return e(l)}}).$mount("#app")},"5ec9":function(e,t,n){},"6a7e":function(e,t,n){"use strict";n("9720")},"853f":function(e,t,n){},"955c":function(e,t,n){"use strict";n("17ff")},9720:function(e,t,n){},a398:function(e,t,n){},adeb:function(e,t,n){"use strict";n("3a62")},b354:function(e,t,n){"use strict";n("a398")},bd05:function(e,t,n){},d5b6:function(e,t,n){"use strict";n("bd05")},d792:function(e,t,n){"use strict";n("1934")},dcca:function(e,t,n){"use strict";n("3bc9")},e91e:function(e,t,n){"use strict";n("f697")},ede1:function(e,t,n){"use strict";n("5ec9")},ef7c:function(e,t,n){"use strict";n("ffb3")},f697:function(e,t,n){},ffb3:function(e,t,n){}});
//# sourceMappingURL=app.fc8f616d.js.map